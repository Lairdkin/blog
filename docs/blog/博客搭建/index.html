<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="站点描述">
<title>
Hexo博客搭建 - RaidishCloud
</title>



        
        <meta property="og:title" content="Hexo博客搭建 - RaidishCloud" />
<meta property="og:type" content="website" />
<meta property="og:description" content="站点描述"/>
<meta property="og:url" content="https://radish.cloud/blog/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
<meta property="og:site_name" content="RaidishCloud"/>







        
<link rel="shortcut icon" href="/img/fav.ico">


        





<link rel="stylesheet" href="/css/main.min.3679995ba0ed4b91edeef430fd34cce1e8b53c123f9993c4861941eee80b46b1.css" integrity="sha256-NnmZW6DtS5Ht7vQw/TTM4ei1PBI/mZPEhhlB7ugLRrE=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

<h1 class="bold-title is-1">博客</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">主页</a>
            

            
            

            
                
            

            
                
            

            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://radish.cloud/projects/">
                  
                  
                  项目
                  
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="https://radish.cloud/blog/">
                  
                  返回 博客
                  
                  </a>
                
                
            
            
            
            

            
            
            <a class="navbar-item" href="/#contact">联系我</a>
            
            

            
            
            
            
            <a class="navbar-item" href="https://radish.cloud/en/">English</a>
            
            

            
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="https://radish.cloud/blog/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">Hexo博客搭建</a>
    </h2>
    <div class="post-data">
        
        2 分钟
    </div>
    
    <div class="blog-share">
        分享:
        
        <a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Hexo%e5%8d%9a%e5%ae%a2%e6%90%ad%e5%bb%ba%20https%3a%2f%2fradish.cloud%2fblog%2f%25E5%258D%259A%25E5%25AE%25A2%25E6%2590%25AD%25E5%25BB%25BA%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fab fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>
        
        
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fradish.cloud%2fblog%2f%25E5%258D%259A%25E5%25AE%25A2%25E6%2590%25AD%25E5%25BB%25BA%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fab fa-facebook-f"></i>
            <span class="hidden">Facebook</span>
        </a>
        
        
        <a class="icon-pinterest" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fradish.cloud%2fblog%2f%25E5%258D%259A%25E5%25AE%25A2%25E6%2590%25AD%25E5%25BB%25BA%2f&amp;description=Hexo%e5%8d%9a%e5%ae%a2%e6%90%ad%e5%bb%ba" onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
            <i class="fab fa-pinterest-p"></i>
            <span class="hidden">Pinterest</span>
        </a>
        
    </div>
    
    
      
    
      
    
      
    
      
      
     <p>
         Tags: 
          
           <a href="/tags/hexo">
             Hexo</a>,
         
           <a href="/tags/nodejs">
             nodejs</a>
         
        </p>
      
    
      
    
</div>

<div class="container markdown top-pad">
    <p>最近记性实在是下降的厉害，搞的东西天天忘，所以把咕了好几年的博客又捡起来了，这次选用了Hexo作为博客的引擎，支持markdown，轻量，部署简单，不过安装中还是踩了一些坑，简单的记录下（其实就是博客太空水一篇2333</p>
<!-- toc -->

<h2 id="环境" class="anchor-link"><a href="#%e7%8e%af%e5%a2%83">环境</a></h2>
<ul>
<li>
<p>服务器：阿里云学生机 轻量级应用服务器</p>
</li>
<li>
<p>服务器系统：Ubuntu16.04</p>
<p>阿里云一直不提供1804的镜像，但是不推荐手动升级，容易挂</p>
</li>
<li>
<p>本地系统：Manjaro 18.0 Illyria</p>
</li>
</ul>

<h2 id="部署" class="anchor-link"><a href="#%e9%83%a8%e7%bd%b2">部署</a></h2>
<p>Hexo生成的是纯静态页面，所以部署只需将hexo生成的public目录放置在 nginx 站点目录下就可以</p>

<h3 id="hexo-安装" class="anchor-link"><a href="#hexo-%e5%ae%89%e8%a3%85">Hexo 安装</a></h3>
<p>安装Hexo 前确保系统有以下软件：</p>
<ul>
<li>Node.js</li>
<li>Git</li>
</ul>
<p>因为Ubuntu源中提供的nodejs版本非常老，所以我们使用<img src="https://nodejs.org" alt="nodejs">官网提供的一个安装方式来安装nodejs</p>
<pre><code class="language-bashv" data-lang="bashv"># Using Ubuntu
curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -
sudo apt-get install -y nodejs

# Using Debian, as root
curl -sL https://deb.nodesource.com/setup_11.x | bash -
apt-get install -y nodejs
</code></pre><p>这个脚本会自动识别系统版本并添加ppa源</p>
<p>然后</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#60a0b0;font-style:italic"># 安装git</span>
sudo apt install git
</code></pre></div><p>因为我们是在服务器端调用hexo生成静态页面，所以本地只需要安装git就可以</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#60a0b0;font-style:italic"># manjaro 安装git</span>
sudo pacman -S git 
<span style="color:#60a0b0;font-style:italic"># 也可以在本地安装nodejs，方便调试</span>
sudo pacman -S nodejs
</code></pre></div><p>然后安装hexo</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> npm install -g hexo-cli
</code></pre></div><p>测试一下</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hexo -v
</code></pre></div><p>输出</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hexo-cli: 1.1.0
os: Linux 4.19.1-1-MANJARO linux x64
http_parser: 2.8.1
node: 11.1.0
v8: 7.0.276.32-node.7
uv: 1.23.2
zlib: 1.2.11
ares: 1.15.0
modules: <span style="color:#40a070">67</span>
nghttp2: 1.34.0
napi: <span style="color:#40a070">3</span>
openssl: 1.1.1
icu: 63.1
unicode: 11.0
cldr: 34.0
tz: 2018e

</code></pre></div><p>Hexo 安装完毕</p>

<h3 id="hexo新建站点和基本配置" class="anchor-link"><a href="#hexo%e6%96%b0%e5%bb%ba%e7%ab%99%e7%82%b9%e5%92%8c%e5%9f%ba%e6%9c%ac%e9%85%8d%e7%bd%ae">Hexo新建站点和基本配置</a></h3>
<p>选择一个存放站点文件的目录，执行</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hexo init “站点名”
</code></pre></div><p>hexo会在当前目录下新建一个站点文件夹，cd进站点文件夹，执行</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">npm install
</code></pre></div><p>执行完成后，生成目录如下</p>
<pre><code>$ tree blog 
blog
├── _config.yml
├── db.json
├── node_modules
├── package.json
├── package-lock.json
├── scaffolds
├── source
└── themes
</code></pre><p>其中_config.yml是整个站点的配置文件，source是存放文章来源的md文件的，package.json存放了站点的依赖，theme是主题文件</p>
<p>在站点文件夹内，使用</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hexo g
</code></pre></div><p>生成静态文件，静态文件存放在该目录的<code>public/</code>下</p>
<p>然后编辑_config.yml</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 站点基本信息</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">title</span>:<span style="color:#bbb">  </span><span style="color:#60a0b0;font-style:italic">#站点名称</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">subtitle</span>:<span style="color:#bbb">  </span><span style="color:#60a0b0;font-style:italic">#子标题</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">description</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">keywords</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">author</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">language</span>:<span style="color:#bbb"> </span>zh-cn<span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic">#语言设置为简体中文</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">timezone</span>:<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 站点链接配置</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">url</span>:<span style="color:#bbb"> </span>http://ljmx.top<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">root</span>:<span style="color:#bbb"> </span>/<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">permalink</span>:<span style="color:#bbb"> </span>:year/:month/:title.html<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">permalink_defaults</span>:<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 一些默认文件的配置</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">source_dir</span>:<span style="color:#bbb"> </span>source<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">public_dir</span>:<span style="color:#bbb"> </span>public<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">tag_dir</span>:<span style="color:#bbb"> </span>tags<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">archive_dir</span>:<span style="color:#bbb"> </span>archives<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">category_dir</span>:<span style="color:#bbb"> </span>categories<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">code_dir</span>:<span style="color:#bbb"> </span>downloads/code<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">i18n_dir</span>:<span style="color:#bbb"> </span>:lang<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">skip_render</span>:<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 使用hexo new 时写作模板</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 因为平时都是直接新建md文件，所以这里一般都用不上QAQ</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># </span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">new_post_name</span>:<span style="color:#bbb"> </span>:title.md<span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic"># File name of new posts</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">default_layout</span>:<span style="color:#bbb"> </span>post<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">titlecase</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">false</span><span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic"># Transform title into titlecase</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">external_link</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">true</span><span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic"># Open external links in new tab</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">filename_case</span>:<span style="color:#bbb"> </span><span style="color:#40a070">0</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">render_drafts</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">post_asset_folder</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">relative_link</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">future</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">highlight</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">enable</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">line_number</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">auto_detect</span>:<span style="color:#bbb"> </span><span style="color:#007020;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">tab_replace</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 主页设定，这个一般根据主题来修改</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">index_generator</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">path</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#39;&#39;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">per_page</span>:<span style="color:#bbb"> </span><span style="color:#40a070">10</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">order_by</span>:<span style="color:#bbb"> </span>-date<span style="color:#bbb">
</span><span style="color:#bbb">  
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 标签</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">default_category</span>:<span style="color:#bbb"> </span>uncategorized<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">category_map</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">tag_map</span>:<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic">#日期格式</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">date_format</span>:<span style="color:#bbb"> </span>YYYY-MM-DD<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">time_format</span>:<span style="color:#bbb"> </span>HH:mm:ss<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 分页</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">per_page</span>:<span style="color:#bbb"> </span><span style="color:#40a070">10</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">pagination_dir</span>:<span style="color:#bbb"> </span>page<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 拓展，主题和插件</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic">## Plugins: https://hexo.io/plugins/</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic">## Themes: https://hexo.io/themes/</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">theme</span>:<span style="color:#bbb"> </span>anatole<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># Deployment</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic">## Docs: https://hexo.io/docs/deployment.html</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#60a0b0;font-style:italic"># 自动部署配置，没用过2333</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#062873;font-weight:bold">deploy</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#062873;font-weight:bold">type</span>:<span style="color:#bbb">
</span><span style="color:#bbb">
</span></code></pre></div><p>然后可以选择一个自己喜欢的主题，放到/theme 文件夹里，在配置文件theme行写上主题名称，生成文件即可更换主题</p>
<blockquote>
<p>我们使用的主题依赖 <code>hexo-render-pug</code>插件，所以启用前需要执行 <code>npm install hexo-render-pug --save</code>安装，才能正常渲染</p>
</blockquote>

<h3 id="nginx-配置" class="anchor-link"><a href="#nginx-%e9%85%8d%e7%bd%ae">Nginx 配置</a></h3>
<p>ubuntu1604 安装nginx</p>
<pre><code>sudo apt install nginx
</code></pre><p>查看服务状态</p>
<pre><code>service nginx status
</code></pre><p>Active状态显示 active证明配置正常</p>
<p>编辑<code>/etc/nginx/nginx.conf</code></p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#60a0b0;font-style:italic">#修改第一行，变更nginx执行权限，其实不推荐这样做，应该修改文件的访问权限，但是我懒233</span>
user root

<span style="color:#60a0b0;font-style:italic">#增加一下一行到文件中</span>
include /etc/nginx/conf.d/*.conf;
</code></pre></div><p>然后在<code>/etc/nginx/conf.d</code>目录中新建一个<code>站点名.conf</code>的文件，编辑这个文件</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
server <span style="color:#666">{</span>
    listen 4000;         <span style="color:#60a0b0;font-style:italic"># 监听端口</span>
    server_name ljmx.top;    <span style="color:#60a0b0;font-style:italic"># 站点域名</span>
    root  /var/www/public;     <span style="color:#60a0b0;font-style:italic"># 站点根目录,指向自己站点的public文件夹</span>
    index index.html index.htm index.php;   <span style="color:#60a0b0;font-style:italic"># 默认导航页</span>
<span style="color:#666">}</span>
</code></pre></div><p>重启nginx</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">service nginx restart
</code></pre></div>
<h3 id="webhook实现自动部署" class="anchor-link"><a href="#webhook%e5%ae%9e%e7%8e%b0%e8%87%aa%e5%8a%a8%e9%83%a8%e7%bd%b2">webhook实现自动部署</a></h3>
<p>现在博客部署好了，但是我每次写完文章，push到github，然后登录服务器，pull下来，执行生成语句，这样比较繁琐，所以我们的webhook就登场了</p>
<p>webhook是git上的一个服务，他提供了一种能力，当仓库发生变动时，webhook会自动post一段信息到预先设定的地址。通过这种方式，我们可以实现自动化生成和部署博客</p>
<p>在github项目主页中，点击<code>setting</code>&gt;<code>webhooks</code>，然后ADD一个新的webhook，Payload URL填写服务器ip+端口号+请求路径，请求类型选json，sceret随便生成，但是要记住。</p>
<p>在hexo站点根目录下新建一个叫webhook.js文件，
填入以下内容:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#007020;font-weight:bold">var</span> http <span style="color:#666">=</span> require(<span style="color:#4070a0">&#39;http&#39;</span>)
<span style="color:#007020;font-weight:bold">var</span> createHandler <span style="color:#666">=</span> require(<span style="color:#4070a0">&#39;github-webhook-handler&#39;</span>)
<span style="color:#007020;font-weight:bold">var</span> handler <span style="color:#666">=</span> createHandler({ path<span style="color:#666">:</span> <span style="color:#4070a0">&#39;/webhooks_push&#39;</span>, secret<span style="color:#666">:</span> <span style="color:#4070a0">&#39;&#39;</span> })
<span style="color:#60a0b0;font-style:italic">// 上面的 secret 保持和 GitHub 后台设置的一致
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">function</span> run_cmd(cmd, args, callback) {
  <span style="color:#007020;font-weight:bold">var</span> spawn <span style="color:#666">=</span> require(<span style="color:#4070a0">&#39;child_process&#39;</span>).spawn;
  <span style="color:#007020;font-weight:bold">var</span> child <span style="color:#666">=</span> spawn(cmd, args);
  <span style="color:#007020;font-weight:bold">var</span> resp <span style="color:#666">=</span> <span style="color:#4070a0">&#34;&#34;</span>;
  child.stdout.on(<span style="color:#4070a0">&#39;data&#39;</span>, <span style="color:#007020;font-weight:bold">function</span>(buffer) { resp <span style="color:#666">+=</span> buffer.toString(); });
  child.stdout.on(<span style="color:#4070a0">&#39;end&#39;</span>, <span style="color:#007020;font-weight:bold">function</span>() { callback (resp) });
}
handler.on(<span style="color:#4070a0">&#39;error&#39;</span>, <span style="color:#007020;font-weight:bold">function</span> (err) {
  console.error(<span style="color:#4070a0">&#39;Error:&#39;</span>, err.message)
})
handler.on(<span style="color:#4070a0">&#39;push&#39;</span>, <span style="color:#007020;font-weight:bold">function</span> (event) {
  console.log(<span style="color:#4070a0">&#39;Received a push event for %s to %s&#39;</span>,
    event.payload.repository.name,
    event.payload.ref);
    run_cmd(<span style="color:#4070a0">&#39;sh&#39;</span>, [<span style="color:#4070a0">&#39;./deploy.sh&#39;</span>], <span style="color:#007020;font-weight:bold">function</span>(text){ console.log(text) });
})
<span style="color:#007020;font-weight:bold">try</span> {
  http.createServer(<span style="color:#007020;font-weight:bold">function</span> (req, res) {
    handler(req, res, <span style="color:#007020;font-weight:bold">function</span> (err) {
      res.statusCode <span style="color:#666">=</span> <span style="color:#40a070">404</span>
      res.end(<span style="color:#4070a0">&#39;no such location&#39;</span>)
    })
  }).listen(<span style="color:#40a070">6000</span>)
  <span style="color:#60a0b0;font-style:italic">//可以在这修改监听端口号
</span><span style="color:#60a0b0;font-style:italic"></span>}<span style="color:#007020;font-weight:bold">catch</span>(err){
  console.error(<span style="color:#4070a0">&#39;Error:&#39;</span>, err.message)
}

</code></pre></div><p>在目录下新建一个deploy.sh的文件，填入以下内容</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#60a0b0;font-style:italic">#填入markdown文件所在位置</span>
<span style="color:#007020">cd</span> /root/website/myblog/source
git reset --hard
git pull origin master  
hexo generate

</code></pre></div><p>然后安装依赖：</p>
<pre><code>npm install github-webhook-handler --save
</code></pre><p>运行</p>
<pre><code>node webhook.js
</code></pre><p>可以使用pm2，或者nohup等方式守护进程</p>
<p>这样当提交pull request的时候，服务器就会自动生成静态文件并部署了</p>

<h2 id="其他" class="anchor-link"><a href="#%e5%85%b6%e4%bb%96">其他</a></h2>
<p>因为时间匆忙（其实就是懒，所以很多东西还没有完善，留给下篇博文吧</p>
<p>待完成</p>
<ul>
<li><input disabled="" type="checkbox"> 修改博客模板</li>
<li><input disabled="" type="checkbox"> 全站ssl</li>
<li><input disabled="" type="checkbox"> 访问统计</li>
<li><input disabled="" type="checkbox"> 资源文件夹</li>
<li><input disabled="" type="checkbox"> 多用户</li>
</ul>

</div>





                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            © 2017-2021 萝卜炖鱼丸 | 蒙ICP备14003205号-2 | <a href="https://creativecommons.org/licenses/by-sa/4.0/"><strong>CC BY-SA 4.0</strong></a> 许可 </br> <a href="https://github.com/victoriadrake/hugo-theme-introduction/"><strong>Introduction</strong></a> 主题为 <a href="http://gohugo.io/">Hugo</a> 而设。由开源社群贡献者以 <a href="https://victoria.dev"><i class="fa fa-heart"></i> 和 <i class="fa fa-coffee"></i></a> 创造。
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="https://radish.cloud/js/bundle.f6c977229f84ae8df89c8647befcf3a170b8157f180a3f0afa4620b19a336994.js" integrity="sha256-9sl3Ip&#43;Ero34nIZHvvzzoXC4FX8YCj8K&#43;kYgsZozaZQ="></script>






        
        
        
        
    </body>
</html>
